# MOOXへのROS2導入方針

最終更新：2020/3/30
作成：株式会社ReBock　岬　伸哉



## はじめに

本ドキュメントはMOOXへのROS2導入方針を記述したものである。
この方針は、メンバーのROS2の理解度、開発フェーズ、ROS2のバージョンアップ、ROS2を取り巻くパッケージの更新等を考慮し、適宜アップデートしていく前提で作成するので、最終仕様ではない。
むしろ積極的に（黎明期は特に）アップデートしていくべきと考えている。



## 各DDS通信の適用方針

DDS通信を使用して提供されている3つのROS2機能の提供方針を記載する。

| 機能       | 使用ケース                                                   |
| ---------- | ------------------------------------------------------------ |
| メッセージ | 各センサーデータの送信<br />各デバイスの状態送信             |
| サービス   | 各デバイスの制御                                             |
| アクション | 使用予定なし<br />現状メッセージとサービスの組み合わせで実現する方が、小回りが効いて良いと思われる。<br />将来的に開発の小回りよりも、パッケージとしての一体感を優先したい場合に利用すれば良いと考える。 |



## パッケージ

ROS2に関するパッケージ作成の方針を記載する。

### パッケージ名

他のパッケージと明確に区別するために`moox_`をprefixとする。
メッセージを送信するノードの場合は、その後に名詞を加える　例：`moox_sensor_data`
デバイス等の制御を行うサービスは、その後ろに動詞を加える　例：`moox_play_sound`

#### 特殊なパッケージ名

`moox_common` 共通処理系を格納するパッケージ。各機能パッケージから参照する。
`moox_interfaces` 独自メッセージ型定義専用パッケージ。メッセージ型は各パッケージで定義せずこのパッケージで定義する

### パッケージの分け方

１機能１パッケージとして作成することを基本方針とする。
これは、あとからバラすよりもまとめるほうが容易である理由からである。
従って、今後ROS2への理解深まり、他社連携時にまとめる可能性も大いにある。
但し、共通機能はなるべく先述の`moox_common`パッケージにまとめることでコードの冗長化は減らす。



## トピック名とメッセージ型

既存のmooxシステムからの変更コストと、ROS2でのトライアンドエラーを考慮し、
トピック名は目的単位以上で不用意に分けない、メッセージ型も標準のstring型にjson化したテキストを格納することで構造の簡素化と実装スピードを優先する。

従って初期段階でのセンサーデータは、以下とする。
topic名：`moox/data/sensor/`
メッセージ型：`std_msgs.msg.String`

### 今後の方針

以下のタイミングで個別に方針を決めていく必要があると考える。

- RvizなどROS2関連機能と連携
- 低レイテンシを要求される、リアルタイム推定への対応
- 各ノード間の通信量最適化、高速化

以上